version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            - npm ci # More reliable than npm install for CI/CD
            - npm run build --workspace=packages/shared # Build shared package first
        build:
          commands:
            - npm run build --workspace=packages/frontend # Build frontend
        # Add post-build phase if needed
        postBuild:
          commands:
            - npm run test # If you have tests
      artifacts:
        baseDirectory: packages/frontend/.next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - packages/frontend/node_modules/**/*
          - packages/shared/node_modules/**/*
          - .next/cache/**/*
      # Add environment configuration
      environment:
        variables:
          NODE_ENV: production